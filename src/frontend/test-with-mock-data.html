<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test KQL Editor with Mock Data</title>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        
        .instructions {
            background: #2d2d30;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #0e639c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #1177bb;
        }
        
        .status {
            margin-top: 20px;
            padding: 10px;
            background: #252526;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>KQL Editor Focus Test with Mock Data</h1>
    
    <div class="instructions">
        <h2>Instructions:</h2>
        <ol>
            <li>Click "Load Application with Mock Data" to open the main app with workspaces pre-loaded</li>
            <li>The KQL Query button should be enabled</li>
            <li>Navigate to KQL Query blade</li>
            <li>Type in the editor to test if focus is lost</li>
        </ol>
    </div>
    
    <button onclick="loadWithMockData()">Load Application with Mock Data</button>
    
    <div id="status" class="status"></div>
    
    <script>
        function loadWithMockData() {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = 'Loading application with mock data...';
            
            // Create a modified version of index.html that auto-loads mock workspaces
            const mockScript = `
                <script>
                    // Auto-load mock workspaces on startup
                    window.addEventListener('DOMContentLoaded', () => {
                        setTimeout(() => {
                            // Override fetch to return mock data
                            const originalFetch = window.fetch;
                            let mockEnabled = true;
                            
                            window.fetch = function(url, ...args) {
                                console.log('Fetch intercepted:', url);
                                
                                if (mockEnabled && url && url.includes('/api/workspaces')) {
                                    console.log('Returning mock workspaces');
                                    return Promise.resolve({
                                        ok: true,
                                        status: 200,
                                        json: () => Promise.resolve({
                                            workspaces: [
                                                { 
                                                    workspaceId: 'ws1', 
                                                    workspaceName: 'Sentinel-Airs', 
                                                    resourceGroup: 'sentinel_encalve_airs', 
                                                    location: 'eastus',
                                                    customerId: 'mock-customer-1'
                                                },
                                                { 
                                                    workspaceId: 'ws2', 
                                                    workspaceName: 'TISentinel', 
                                                    resourceGroup: 'ThreatIntel', 
                                                    location: 'eastus',
                                                    customerId: 'mock-customer-2'
                                                },
                                                { 
                                                    workspaceId: 'ws3', 
                                                    workspaceName: 'IdentityPlayground', 
                                                    resourceGroup: 'IdentityPlayground', 
                                                    location: 'eastus',
                                                    customerId: 'mock-customer-3'
                                                }
                                            ]
                                        })
                                    });
                                }
                                
                                return originalFetch.apply(this, [url, ...args]);
                            };
                            
                            // Auto-click discover workspaces after a delay
                            setTimeout(() => {
                                // Find the discover button if it exists
                                const buttons = Array.from(document.querySelectorAll('button'));
                                const discoverBtn = buttons.find(btn => 
                                    btn.textContent.includes('Discover') || 
                                    btn.textContent.includes('Refresh')
                                );
                                
                                if (discoverBtn) {
                                    console.log('Auto-clicking discover button');
                                    discoverBtn.click();
                                } else {
                                    // Try to trigger discovery directly
                                    console.log('Trying to trigger workspace discovery directly');
                                    if (window.discoverWorkspaces) {
                                        window.discoverWorkspaces();
                                    }
                                }
                            }, 2000);
                        }, 1000);
                    });
                <\/script>
            `;
            
            // Load the main application in a new window with mock data injection
            const newWindow = window.open('index.html', '_blank');
            
            // Try to inject the mock script
            setTimeout(() => {
                if (newWindow && !newWindow.closed) {
                    try {
                        const script = newWindow.document.createElement('script');
                        script.innerHTML = mockScript.replace(/<\/?script>/g, '');
                        newWindow.document.head.appendChild(script);
                        statusDiv.innerHTML = 'Application loaded with mock data injection. Check the new window.';
                    } catch (e) {
                        statusDiv.innerHTML = 'Could not inject mock data due to cross-origin restrictions. Opening plain application.';
                    }
                }
            }, 500);
        }
    </script>
</body>
</html>